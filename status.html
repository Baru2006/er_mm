<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Order Status - Easy Recharge MM</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <a href="index.html" class="back-link">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 11H7.83l5.59-5.59L12 4l-8 8 8 8 1.41-1.41L7.83 13H20v-2z"/>
                </svg>
                Back
            </a>
            <div class="brand">
                <h1>Order Status</h1>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <span class="theme-icon">ðŸŒ™</span>
            </button>
        </header>

        <!-- Tabs -->
        <div class="tabs">
            <button class="tab active" data-tab="orders">Your Orders</button>
            <button class="tab" data-tab="p2p">P2P Status</button>
        </div>

        <!-- Refresh Button -->
        <div style="text-align: right; margin-bottom: 20px;">
            <button id="refreshBtn" class="copy-btn" style="display: inline-flex; align-items: center; gap: 8px;">
                <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18">
                    <path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
                </svg>
                Refresh
            </button>
        </div>

        <!-- Orders Tab -->
        <div id="orders" class="tab-content active">
            <div class="form-container">
                <h4>ðŸ“¦ Your Recent Orders</h4>
                <div id="ordersContainer">
                    <p class="text-center">Loading orders...</p>
                </div>
            </div>
        </div>

        <!-- P2P Tab -->
        <div id="p2p" class="tab-content">
            <div class="form-container">
                <h4>ðŸ’± Your P2P Exchanges</h4>
                <div id="p2pContainer">
                    <p class="text-center">Loading P2P exchanges...</p>
                </div>
            </div>
        </div>

        <!-- Status Legend -->
        <div class="form-container">
            <h4>Status Legend:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px;">
                <div class="status-badge status-pending">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Pending
                </div>
                <div class="status-badge status-processing">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Processing
                </div>
                <div class="status-badge status-success">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
                    </svg>
                    Success
                </div>
                <div class="status-badge status-cancelled">
                    <svg viewBox="0 0 24 24" fill="currentColor" width="14" height="14">
                        <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                    </svg>
                    Cancelled
                </div>
            </div>
        </div>

        <!-- Bottom Navigation -->
        <nav class="bottom-nav">
            <a href="index.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/>
                </svg>
                <span>Dashboard</span>
            </a>
            <a href="order.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M13 2v8h8c0-4.42-3.58-8-8-8zm2 6V4.34c1.7.6 3.05 1.95 3.66 3.66H15zm-8.56 3l-.95-2H2v2h2.22s1.89 4.07 2.12 4.42c-1.1.59-1.84 1.75-1.84 3.08C4.5 20.43 6.07 22 8 22c1.76 0 3.22-1.3 3.46-3h2.08c.24 1.7 1.7 3 3.46 3 1.93 0 3.5-1.57 3.5-3.5 0-1.04-.46-1.97-1.18-2.61C20.37 14.54 21 12.84 21 11H6.44z"/>
                </svg>
                <span>Orders</span>
            </a>
            <a href="pay.html" class="nav-item">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M20 4H4c-1.11 0-1.99.89-1.99 2L2 18c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V6c0-1.11-.89-2-2-2zm0 14H4v-6h16v6zm0-10H4V6h16v2z"/>
                </svg>
                <span>Exchange</span>
            </a>
            <a href="status.html" class="nav-item active">
                <svg viewBox="0 0 24 24" fill="currentColor">
                    <path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V5h14v14z"/>
                    <path d="M7 10h2v7H7zm4-3h2v10h-2zm4-3h2v13h-2z"/>
                </svg>
                <span>Status</span>
            </a>
        </nav>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast"></div>

    <script src="script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Load initial orders
            loadOrders();
            
            // Refresh button
            document.getElementById('refreshBtn').addEventListener('click', function() {
                loadOrders();
                showToast('Refreshing orders...');
            });
            
            // Tab functionality
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Update active tab
                    document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Show active content
                    document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                    document.getElementById(tabId).classList.add('active');
                    
                    // Load content if needed
                    if (tabId === 'p2p') {
                        loadP2PExchanges();
                    }
                });
            });
            
            function loadOrders() {
                const userId = localStorage.getItem('userId');
                if (!userId) return;
                
                fetch(`${GAS_URL}?action=list&userId=${userId}`)
                    .then(response => response.json())
                    .then(orders => {
                        displayOrders(orders);
                    })
                    .catch(error => {
                        console.error('Failed to load orders:', error);
                        document.getElementById('ordersContainer').innerHTML = '<p class="text-center">Failed to load orders</p>';
                    });
            }
            
            function loadP2PExchanges() {
                // This would require additional backend support
                document.getElementById('p2pContainer').innerHTML = '<p class="text-center">P2P exchange tracking coming soon</p>';
            }
            
            function displayOrders(orders) {
                const container = document.getElementById('ordersContainer');
                
                if (!orders || orders.length === 0) {
                    container.innerHTML = '<p class="text-center">No orders found</p>';
                    return;
                }
                
                const ordersHtml = orders.map(order => `
                    <div class="order-item" style="border: 1px solid var(--border-color); border-radius: var(--radius); padding: 15px; margin-bottom: 15px;">
                        <div style="display: flex; justify-content: between; align-items: start; margin-bottom: 10px;">
                            <div>
                                <strong>${order.OrderID || order.orderId}</strong>
                                <div style="font-size: 0.8rem; opacity: 0.7; margin-top: 5px;">
                                    ${formatDate(order.Timestamp || order.timestamp)}
                                </div>
                            </div>
                            <div class="status-badge status-${(order.Status || 'pending').toLowerCase()}">
                                ${order.Status || 'Pending'}
                            </div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; font-size: 0.9rem;">
                            <div>
                                <strong>Service:</strong><br>
                                ${order.Service || order.service}
                            </div>
                            <div>
                                <strong>Amount:</strong><br>
                                ${order.Total || order.total} MMK
                            </div>
                            <div>
                                <strong>Payment:</strong><br>
                                ${order.Payment || order.payment}
                            </div>
                            <div>
                                <strong>Transaction:</strong><br>
                                ${(order.TransactionID || order.transactionId || '').substring(0, 8)}...
                            </div>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = ordersHtml;
            }
        });
    </script>
</body>
</html>
