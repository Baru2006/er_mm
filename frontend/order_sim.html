<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>SIM Order — Easy Recharge MM</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="site-header">
    <div class="container">
      <h1>SIM Recharge</h1>
      <div id="user-info" class="user-info"></div>
    </div>
  </header>

  <main class="container form-page">
    <section class="admin-box">
      <p>Admin Phone: <strong id="admin-phone" onclick="copyAdminPhone()">09xxxxxxxx</strong></p>
    </section>

    <form id="sim-order-form" class="order-form">
      <!-- Provider -->
      <label for="provider">Provider</label>
      <select id="provider" name="provider" required>
        <option value="">— Select provider —</option>
        <option value="MPT">MPT</option>
        <option value="Telenor">Telenor</option>
        <option value="Ooredoo">Ooredoo</option>
      </select>

      <!-- Package -->
      <label for="pkg">Package</label>
      <select id="pkg" name="pkg" required>
        <option value="">— Select package —</option>
        <option value="1000">1000 Ks</option>
        <option value="2000">2000 Ks</option>
        <option value="3000">3000 Ks</option>
        <!-- Add more packages as needed -->
      </select>

      <!-- Description (auto) -->
      <p id="description" class="muted">Package description appears here</p>

      <!-- User phone -->
      <label for="userPhone">Recipient Phone</label>
      <input id="userPhone" name="userPhone" type="text" placeholder="09xxxxxxxx" required />

      <!-- Total -->
      <div class="summary-line">
        <span>Total</span>
        <strong id="total">0</strong> <span>Ks</span>
      </div>

      <!-- Transaction ID -->
      <label for="txId">Transaction ID</label>
      <input id="txId" name="txId" type="text" placeholder="e.g. 123456789" required />

      <button type="submit" class="btn">Submit Order</button>
    </form>
  </main>

  <script type="module" src="price.js"></script>
  <script type="module" src="script.js"></script>
  <script>
    // page-specific logic
    import { PRICES } from './price.js';

    const pkgSelect = document.getElementById('pkg');
    const desc = document.getElementById('description');
    const totalEl = document.getElementById('total');
    const form = document.getElementById('sim-order-form');

    function recalc() {
      const pkg = Number(pkgSelect.value) || 0;
      const role = localStorage.getItem('role') || 'Customer';
      const priceFactor = PRICES.sim?.[role] ?? 1;
      totalEl.textContent = Math.round(pkg * priceFactor);
      desc.textContent = pkg ? `Top-up ${pkg} Ks to selected provider.` : 'Package description appears here';
    }

    pkgSelect.addEventListener('change', recalc);

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      // basic validation
      const payload = {
        type: 'sim',
        provider: form.provider.value,
        package: form.pkg.value,
        userPhone: form.userPhone.value,
        txId: form.txId.value,
        total: Number(totalEl.textContent),
        userId: localStorage.getItem('userId') || null
      };
      await sendOrder(payload);
    });

    // initial calculation
    recalc();
  </script>
</body>
</html>
