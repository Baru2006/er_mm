<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Order SIM/Data - Easy Recharge MM</title>
  <link rel="stylesheet" href="style.css">
  <script src="script.js" defer></script>
</head>
<body>
  <header>Order SIM / Data</header>

  <div class="container">
    <!-- Admin Phone -->
    <div class="card">
      <h2>ðŸ“ž Admin Contact</h2>
      <p>Call/WhatsApp: <span id="adminPhone">09-123456789</span>
        <button onclick="copyAdminPhone()">Copy</button>
      </p>
    </div>

    <!-- Order Form -->
    <form id="simOrderForm">
      <!-- SIM Provider -->
      <label for="provider">SIM Provider</label>
      <select id="provider" required>
        <option value="">Select Provider</option>
        <option value="mpt">MPT</option>
        <option value="telenor">Telenor</option>
        <option value="ooredoo">Ooredoo</option>
      </select>

      <!-- Data Package -->
      <label for="package">Data Package</label>
      <select id="package" required>
        <option value="">Select Package</option>
      </select>
      <p id="packageDesc"></p>

      <!-- Phone Number -->
      <label for="phone">Phone Number</label>
      <input type="tel" id="phone" placeholder="09xxxxxxxx" required>

      <!-- Quantity -->
      <label for="quantity">Quantity</label>
      <input type="number" id="quantity" value="1" readonly>

      <!-- Total Price -->
      <label for="total">Total Price (MMK)</label>
      <input type="text" id="total" readonly>

      <!-- Transaction ID -->
      <label for="transactionId">Transaction ID</label>
      <input type="text" id="transactionId" placeholder="Enter after payment" required>

      <button type="submit">Submit Order</button>
    </form>
  </div>

  <script>
    const providerSelect = document.getElementById('provider');
    const packageSelect = document.getElementById('package');
    const packageDesc = document.getElementById('packageDesc');
    const quantityInput = document.getElementById('quantity');
    const totalInput = document.getElementById('total');
    const form = document.getElementById('simOrderForm');

    // Populate packages dynamically
    providerSelect.addEventListener('change', () => {
      const provider = providerSelect.value;
      packageSelect.innerHTML = '<option value="">Select Package</option>';
      if(SERVICE_PRICES.sim) {
        Object.keys(SERVICE_PRICES.sim).forEach(key => {
          if(key.startsWith(provider)) {
            const option = document.createElement('option');
            option.value = key;
            option.textContent = SERVICE_PRICES.sim[key].name;
            packageSelect.appendChild(option);
          }
        });
      }
      packageDesc.textContent = '';
      totalInput.value = '';
    });

    packageSelect.addEventListener('change', () => {
      const key = packageSelect.value;
      if(SERVICE_PRICES.sim[key]){
        packageDesc.textContent = SERVICE_PRICES.sim[key].description;
        const qty = parseInt(quantityInput.value) || 1;
        totalInput.value = SERVICE_PRICES.sim[key].price * qty;
      } else {
        packageDesc.textContent = '';
        totalInput.value = '';
      }
    });

    // Submit Form
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const provider = providerSelect.value;
      const serviceKey = packageSelect.value;
      const serviceName = SERVICE_PRICES.sim[serviceKey]?.name || '';
      const phone = document.getElementById('phone').value;
      const quantity = parseInt(quantityInput.value);
      const total = parseInt(totalInput.value);
      const transactionId = document.getElementById('transactionId').value;
      const payment = "Bank/Wallet"; // Optional, can add select later

      if(!provider || !serviceKey || !phone || !transactionId){
        showToast('Please fill all required fields', 'error');
        return;
      }

      const data = {
        action: 'submit_sim_order',
        userId: 'Guest',
        service: serviceKey,
        serviceName: serviceName,
        phone: phone,
        quantity: quantity,
        total: total,
        payment: payment,
        transactionId: transactionId
      };

      try {
        const res = await fetch(GAS_URL, {
          method: 'POST',
          body: JSON.stringify(data)
        });
        const result = await res.json();
        if(result.success){
          showToast('Order submitted successfully!', 'success');
          form.reset();
          totalInput.value = '';
          packageDesc.textContent = '';
        } else {
          showToast('Submission failed: '+result.error, 'error');
        }
      } catch(err) {
        showToast('Error submitting order', 'error');
      }
    });
  </script>
</body>
</html>
